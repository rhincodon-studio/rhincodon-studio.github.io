"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3408],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var r=i(96540);const t={},s=r.createContext(t);function l(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(s.Provider,{value:n},e.children)}},71270:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"architecture/auth-zitadel-openfga-cerbos","title":"Zitadel with Angular, Spring Boot Gateway, OpenFGA, and Cerbos","description":"A practical authentication and authorization architecture using Zitadel, social login, OpenFGA, and Cerbos","source":"@site/docs/architecture/auth-zitadel-openfga-cerbos.md","sourceDirName":"architecture","slug":"/architecture/auth-zitadel-openfga-cerbos","permalink":"/docs/architecture/auth-zitadel-openfga-cerbos","draft":false,"unlisted":false,"editUrl":"https://github.com/rhincodon-studio/my-website/tree/main/docs/architecture/auth-zitadel-openfga-cerbos.md","tags":[],"version":"current","frontMatter":{"title":"Zitadel with Angular, Spring Boot Gateway, OpenFGA, and Cerbos","description":"A practical authentication and authorization architecture using Zitadel, social login, OpenFGA, and Cerbos"},"sidebar":"tutorialSidebar","previous":{"title":"\u6536\u8cbb\u689d\u6b3e","permalink":"/docs/pricing/pricing-policy"},"next":{"title":"Why You Should Not Rely Only on Zitadel Roles for Authorization","permalink":"/docs/architecture/why-not-only-zitadel-role"}}');var t=i(74848),s=i(28453);const l={title:"Zitadel with Angular, Spring Boot Gateway, OpenFGA, and Cerbos",description:"A practical authentication and authorization architecture using Zitadel, social login, OpenFGA, and Cerbos"},a=void 0,o={},c=[{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"High-Level Architecture Diagram",id:"high-level-architecture-diagram",level:2},{value:"Authentication Layer",id:"authentication-layer",level:2},{value:"Zitadel",id:"zitadel",level:3},{value:"Google and LINE Login",id:"google-and-line-login",level:2},{value:"Frontend Login Flow",id:"frontend-login-flow",level:2},{value:"API Gateway Responsibility",id:"api-gateway-responsibility",level:2},{value:"Relationship Authorization with OpenFGA",id:"relationship-authorization-with-openfga",level:2},{value:"Policy Evaluation with Cerbos",id:"policy-evaluation-with-cerbos",level:2},{value:"Authorization Decision Flow",id:"authorization-decision-flow",level:2},{value:"Why This Separation Works",id:"why-this-separation-works",level:2},{value:"Notes on Zitadel Roles",id:"notes-on-zitadel-roles",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={h2:"h2",h3:"h3",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,t.jsx)(n.p,{children:"This document describes a production-ready authentication and authorization architecture built with:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Zitadel as the Identity Provider"}),"\n",(0,t.jsx)(n.li,{children:"Google and LINE as external login providers"}),"\n",(0,t.jsx)(n.li,{children:"Angular as the frontend application"}),"\n",(0,t.jsx)(n.li,{children:"Spring Boot API Gateway as the entry point"}),"\n",(0,t.jsx)(n.li,{children:"OpenFGA for relationship-based authorization"}),"\n",(0,t.jsx)(n.li,{children:"Cerbos for policy-based access control"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The goal is to clearly separate responsibilities between authentication, relationship authorization, and business policy evaluation."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"high-level-architecture-diagram",children:"High-Level Architecture Diagram"}),"\n",(0,t.jsx)(n.mermaid,{value:"flowchart LR\n    User[User<br/>Browser]\n\n    Angular[Angular SPA<br/>Public Client]\n\n    Zitadel[Zitadel<br/>OIDC Provider]\n\n    Google[Google Identity<br/>OIDC]\n    Line[LINE Login<br/>OIDC]\n\n    Gateway[Spring Boot<br/>API Gateway<br/>OAuth2 Resource Server]\n\n    OpenFGA[OpenFGA<br/>Relationship Authorization]\n\n    Cerbos[Cerbos<br/>Policy Decision Point]\n\n    API[Backend APIs<br/>Microservices]\n\n    User --\x3e Angular\n\n    Angular --\x3e|Login| Zitadel\n\n    Zitadel --\x3e|Redirect| Google\n    Zitadel --\x3e|Redirect| Line\n\n    Google --\x3e|Auth Code| Zitadel\n    Line --\x3e|Auth Code| Zitadel\n\n    Zitadel --\x3e|Access Token<br/>ID Token| Angular\n\n    Angular --\x3e|Bearer Token| Gateway\n\n    Gateway --\x3e|Validate JWT<br/>JWKS| Zitadel\n\n    Gateway --\x3e|Check Relationship| OpenFGA\n\n    OpenFGA --\x3e|Permission Result| Gateway\n\n    Gateway --\x3e|Evaluate Policy| Cerbos\n\n    Cerbos --\x3e|Allow or Deny| Gateway\n\n    Gateway --\x3e|Forward Request<br/>User Context| API"}),"\n",(0,t.jsx)(n.h2,{id:"authentication-layer",children:"Authentication Layer"}),"\n",(0,t.jsx)(n.h3,{id:"zitadel",children:"Zitadel"}),"\n",(0,t.jsx)(n.p,{children:"Zitadel acts as the central identity provider:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Issues access token and ID token"}),"\n",(0,t.jsx)(n.li,{children:"Manages users, organizations, and coarse-grained roles"}),"\n",(0,t.jsx)(n.li,{children:"Integrates with external identity providers"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Angular and backend services only trust tokens issued by Zitadel."}),"\n",(0,t.jsx)(n.p,{children:"\u2e3b"}),"\n",(0,t.jsx)(n.h2,{id:"google-and-line-login",children:"Google and LINE Login"}),"\n",(0,t.jsx)(n.p,{children:"Google and LINE are configured as external identity providers inside Zitadel."}),"\n",(0,t.jsx)(n.p,{children:"Key points:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Angular never talks directly to Google or LINE"}),"\n",(0,t.jsx)(n.li,{children:"All tokens consumed by the system are issued by Zitadel"}),"\n",(0,t.jsx)(n.li,{children:"Account linking and user lifecycle remain centralized"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This avoids frontend complexity and prevents token trust fragmentation."}),"\n",(0,t.jsx)(n.p,{children:"\u2e3b"}),"\n",(0,t.jsx)(n.h2,{id:"frontend-login-flow",children:"Frontend Login Flow"}),"\n",(0,t.jsx)(n.p,{children:"Angular uses OAuth2 Authorization Code Flow with PKCE."}),"\n",(0,t.jsx)(n.p,{children:"Flow summary:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"User clicks login"}),"\n",(0,t.jsx)(n.li,{children:"Angular redirects to Zitadel"}),"\n",(0,t.jsx)(n.li,{children:"User chooses Google or LINE"}),"\n",(0,t.jsx)(n.li,{children:"Zitadel completes authentication"}),"\n",(0,t.jsx)(n.li,{children:"Angular receives access token and ID token"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Token usage:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"access token is used for API calls"}),"\n",(0,t.jsx)(n.li,{children:"ID token is used only by the frontend for user information"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u2e3b"}),"\n",(0,t.jsx)(n.h2,{id:"api-gateway-responsibility",children:"API Gateway Responsibility"}),"\n",(0,t.jsx)(n.p,{children:"The Spring Boot API Gateway acts as an OAuth2 Resource Server."}),"\n",(0,t.jsx)(n.p,{children:"Its responsibilities are intentionally limited and strict:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Validate JWT signature using Zitadel JWKS"}),"\n",(0,t.jsx)(n.li,{children:"Verify issuer, audience, and expiry"}),"\n",(0,t.jsx)(n.li,{children:"Reject invalid or expired tokens"}),"\n",(0,t.jsx)(n.li,{children:"Do not call Zitadel for introspection per request"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Token validation is done locally for performance and reliability."}),"\n",(0,t.jsx)(n.p,{children:"\u2e3b"}),"\n",(0,t.jsx)(n.h2,{id:"relationship-authorization-with-openfga",children:"Relationship Authorization with OpenFGA"}),"\n",(0,t.jsx)(n.p,{children:"OpenFGA is responsible for object-level and relationship-based authorization."}),"\n",(0,t.jsx)(n.p,{children:"Typical questions handled by OpenFGA:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Is the user a member of this organization"}),"\n",(0,t.jsx)(n.li,{children:"Is the user the owner of this resource"}),"\n",(0,t.jsx)(n.li,{children:"Does the user have editor access to this document"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"These checks are fast and scale well with large numbers of users and resources."}),"\n",(0,t.jsx)(n.p,{children:"Relationship data is usually written when:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A user joins a project"}),"\n",(0,t.jsx)(n.li,{children:"A resource is created"}),"\n",(0,t.jsx)(n.li,{children:"Ownership or membership changes"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u2e3b"}),"\n",(0,t.jsx)(n.h2,{id:"policy-evaluation-with-cerbos",children:"Policy Evaluation with Cerbos"}),"\n",(0,t.jsx)(n.p,{children:"Cerbos handles business rules and conditional access logic."}),"\n",(0,t.jsx)(n.p,{children:"Examples of policies:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Editors can update resources only in active status"}),"\n",(0,t.jsx)(n.li,{children:"Access is blocked outside business hours"}),"\n",(0,t.jsx)(n.li,{children:"Feature access depends on subscription plan"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Cerbos does not store data and does not know about Zitadel or OpenFGA."}),"\n",(0,t.jsx)(n.p,{children:"It evaluates decisions based on attributes provided by the API Gateway."}),"\n",(0,t.jsx)(n.p,{children:"\u2e3b"}),"\n",(0,t.jsx)(n.h2,{id:"authorization-decision-flow",children:"Authorization Decision Flow"}),"\n",(0,t.jsx)(n.p,{children:"The API Gateway performs authorization in this order:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Validate access token"}),"\n",(0,t.jsx)(n.li,{children:"Check relationship permission via OpenFGA"}),"\n",(0,t.jsx)(n.li,{children:"Evaluate business policy via Cerbos"}),"\n",(0,t.jsx)(n.li,{children:"Allow or deny the request"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This separation keeps each system focused and maintainable."}),"\n",(0,t.jsx)(n.p,{children:"\u2e3b"}),"\n",(0,t.jsx)(n.h2,{id:"why-this-separation-works",children:"Why This Separation Works"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Authentication logic is isolated"}),"\n",(0,t.jsx)(n.li,{children:"Relationship complexity does not leak into policies"}),"\n",(0,t.jsx)(n.li,{children:"Business rules are not hard-coded in services"}),"\n",(0,t.jsx)(n.li,{children:"Each component can evolve independently"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This architecture scales well for SaaS platforms and multi-tenant systems."}),"\n",(0,t.jsx)(n.p,{children:"\u2e3b"}),"\n",(0,t.jsx)(n.h2,{id:"notes-on-zitadel-roles",children:"Notes on Zitadel Roles"}),"\n",(0,t.jsx)(n.p,{children:"Zitadel roles are best used for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"High-level access"}),"\n",(0,t.jsx)(n.li,{children:"Admin versus normal user"}),"\n",(0,t.jsx)(n.li,{children:"UI feature toggling"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"They should not be used for fine-grained or object-level permissions."}),"\n",(0,t.jsx)(n.p,{children:"Those belong in OpenFGA and Cerbos."}),"\n",(0,t.jsx)(n.p,{children:"\u2e3b"}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Zitadel answers who the user is"}),"\n",(0,t.jsx)(n.li,{children:"OpenFGA answers what the user is related to"}),"\n",(0,t.jsx)(n.li,{children:"Cerbos answers whether the action is allowed under current conditions"}),"\n",(0,t.jsx)(n.li,{children:"The API Gateway enforces the final decision"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This results in a clean, scalable, and auditable authorization architecture."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);