"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9263],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>a});var s=i(96540);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}},98383:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"auth/architecture/why-multi-layer","title":"Why Multi-Layer Authorization is Necessary","description":"Limitations of role-based access control and why fine-grained authorization requires separating authentication, relationships, and policies","source":"@site/docs/auth/01-architecture/why-multi-layer.md","sourceDirName":"auth/01-architecture","slug":"/auth/architecture/why-multi-layer","permalink":"/docs/auth/architecture/why-multi-layer","draft":false,"unlisted":false,"editUrl":"https://github.com/rhincodon-studio/my-website/tree/main/docs/auth/01-architecture/why-multi-layer.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Why Multi-Layer Authorization is Necessary","description":"Limitations of role-based access control and why fine-grained authorization requires separating authentication, relationships, and policies","sidebar_position":2,"author":"balnibarbian"},"sidebar":"tutorialSidebar","previous":{"title":"Architecture Overview","permalink":"/docs/auth/architecture/overview"},"next":{"title":"OpenFGA","permalink":"/docs/category/openfga"}}');var r=i(74848),l=i(28453);const t={title:"Why Multi-Layer Authorization is Necessary",description:"Limitations of role-based access control and why fine-grained authorization requires separating authentication, relationships, and policies",sidebar_position:2,author:"balnibarbian"},a=void 0,o={},c=[{value:"Background",id:"background",level:2},{value:"What Zitadel Roles Are Good At",id:"what-zitadel-roles-are-good-at",level:2},{value:"Where Zitadel Roles Start to Break Down",id:"where-zitadel-roles-start-to-break-down",level:2},{value:"Lack of Object-Level Permission",id:"lack-of-object-level-permission",level:3},{value:"Role Explosion Problem",id:"role-explosion-problem",level:3},{value:"No Relationship Awareness",id:"no-relationship-awareness",level:3},{value:"No Conditional or Contextual Rules",id:"no-conditional-or-contextual-rules",level:3},{value:"Security and Maintenance Risks",id:"security-and-maintenance-risks",level:2},{value:"Recommended Responsibility Split",id:"recommended-responsibility-split",level:2},{value:"Zitadel",id:"zitadel",level:3},{value:"OpenFGA",id:"openfga",level:3},{value:"Cerbos",id:"cerbos",level:3},{value:"Why This Matters for SaaS and Multi-Tenant Systems",id:"why-this-matters-for-saas-and-multi-tenant-systems",level:2},{value:"Practical Guideline",id:"practical-guideline",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={br:"br",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,r.jsx)(n.p,{children:"Zitadel provides built-in role management and is often the first place teams implement authorization."}),"\n",(0,r.jsxs)(n.p,{children:["At early stages, using roles such as admin, member, or viewer seems sufficient.",(0,r.jsx)(n.br,{}),"\n","However, as the system grows, relying only on Zitadel roles quickly becomes a limiting factor."]}),"\n",(0,r.jsx)(n.p,{children:"This document explains why Zitadel roles should remain coarse-grained and why fine-grained authorization should be handled elsewhere."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"what-zitadel-roles-are-good-at",children:"What Zitadel Roles Are Good At"}),"\n",(0,r.jsx)(n.p,{children:"Zitadel roles work well for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"High-level access classification"}),"\n",(0,r.jsx)(n.li,{children:"Distinguishing admin users from normal users"}),"\n",(0,r.jsx)(n.li,{children:"Feature visibility in frontend applications"}),"\n",(0,r.jsx)(n.li,{children:"Organization-level permissions"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Typical examples:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"system_admin"}),"\n",(0,r.jsx)(n.li,{children:"org_admin"}),"\n",(0,r.jsx)(n.li,{children:"org_member"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"These roles are stable, rarely change, and are closely tied to identity rather than resources."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"where-zitadel-roles-start-to-break-down",children:"Where Zitadel Roles Start to Break Down"}),"\n",(0,r.jsx)(n.h3,{id:"lack-of-object-level-permission",children:"Lack of Object-Level Permission"}),"\n",(0,r.jsx)(n.p,{children:"Zitadel roles cannot express permissions like:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"User A can edit document X but not document Y"}),"\n",(0,r.jsx)(n.li,{children:"User B is owner of project 123 but only viewer of project 456"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Roles are assigned to users, not to relationships between users and resources."}),"\n",(0,r.jsx)(n.p,{children:"Once you try to model object-level access with roles, you end up with patterns like:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"project_123_admin"}),"\n",(0,r.jsx)(n.li,{children:"project_456_viewer"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This does not scale."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"role-explosion-problem",children:"Role Explosion Problem"}),"\n",(0,r.jsx)(n.p,{children:"As the number of resources grows, roles multiply rapidly."}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"100 projects"}),"\n",(0,r.jsx)(n.li,{children:"3 permission levels per project"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"That already means hundreds of roles."}),"\n",(0,r.jsx)(n.p,{children:"Problems that follow:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Hard to manage"}),"\n",(0,r.jsx)(n.li,{children:"Hard to audit"}),"\n",(0,r.jsx)(n.li,{children:"Hard to reason about"}),"\n",(0,r.jsx)(n.li,{children:"Hard to remove safely"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Roles stop being meaningful and become identifiers for data relationships, which is not their purpose."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"no-relationship-awareness",children:"No Relationship Awareness"}),"\n",(0,r.jsx)(n.p,{children:"Zitadel roles do not understand relationships such as:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Membership inheritance"}),"\n",(0,r.jsx)(n.li,{children:"Ownership chains"}),"\n",(0,r.jsx)(n.li,{children:"Parent-child resource structures"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Examples that are difficult or impossible to model:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Organization members automatically gaining access to new projects"}),"\n",(0,r.jsx)(n.li,{children:"Team membership granting access to all team resources"}),"\n",(0,r.jsx)(n.li,{children:"Shared resources across organizations"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"These are relationship problems, not identity problems."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"no-conditional-or-contextual-rules",children:"No Conditional or Contextual Rules"}),"\n",(0,r.jsx)(n.p,{children:"Zitadel roles are static."}),"\n",(0,r.jsx)(n.p,{children:"They cannot express conditions such as:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Allow access only during business hours"}),"\n",(0,r.jsx)(n.li,{children:"Block write access when resource status is archived"}),"\n",(0,r.jsx)(n.li,{children:"Restrict actions based on subscription plan"}),"\n",(0,r.jsx)(n.li,{children:"Environment-based access differences"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Trying to encode conditions into roles leads to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"duplicated roles"}),"\n",(0,r.jsx)(n.li,{children:"unclear semantics"}),"\n",(0,r.jsx)(n.li,{children:"logic leaking into application code"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"security-and-maintenance-risks",children:"Security and Maintenance Risks"}),"\n",(0,r.jsx)(n.p,{children:"When roles are overloaded to handle authorization logic:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Authorization rules leak into backend code"}),"\n",(0,r.jsx)(n.li,{children:"Frontend starts making security decisions"}),"\n",(0,r.jsx)(n.li,{children:"Small changes require role migrations"}),"\n",(0,r.jsx)(n.li,{children:"Auditing becomes difficult"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This increases the risk of:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"accidental privilege escalation"}),"\n",(0,r.jsx)(n.li,{children:"inconsistent behavior across services"}),"\n",(0,r.jsx)(n.li,{children:"fragile access control logic"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"recommended-responsibility-split",children:"Recommended Responsibility Split"}),"\n",(0,r.jsx)(n.p,{children:"A scalable system separates concerns clearly."}),"\n",(0,r.jsx)(n.h3,{id:"zitadel",children:"Zitadel"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Authentication"}),"\n",(0,r.jsx)(n.li,{children:"User identity"}),"\n",(0,r.jsx)(n.li,{children:"Organization and high-level roles"}),"\n",(0,r.jsx)(n.li,{children:"Token issuance"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Zitadel answers:"}),"\n",(0,r.jsx)(n.p,{children:"Who is the user?"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"openfga",children:"OpenFGA"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Relationship-based authorization"}),"\n",(0,r.jsx)(n.li,{children:"Ownership and membership"}),"\n",(0,r.jsx)(n.li,{children:"Object-level permission checks"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"OpenFGA answers:"}),"\n",(0,r.jsx)(n.p,{children:"Is this user related to this resource in this way?"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"cerbos",children:"Cerbos"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Policy-based access control"}),"\n",(0,r.jsx)(n.li,{children:"Conditional rules"}),"\n",(0,r.jsx)(n.li,{children:"Business logic enforcement"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Cerbos answers:"}),"\n",(0,r.jsx)(n.p,{children:"Given the current context, is this action allowed?"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"why-this-matters-for-saas-and-multi-tenant-systems",children:"Why This Matters for SaaS and Multi-Tenant Systems"}),"\n",(0,r.jsx)(n.p,{children:"In SaaS systems:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Resources grow faster than users"}),"\n",(0,r.jsx)(n.li,{children:"Permissions change frequently"}),"\n",(0,r.jsx)(n.li,{children:"Business rules evolve over time"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Using only roles tightly couples identity with authorization logic, making change expensive and risky."}),"\n",(0,r.jsx)(n.p,{children:"Separating roles, relationships, and policies allows:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"independent evolution"}),"\n",(0,r.jsx)(n.li,{children:"clearer mental models"}),"\n",(0,r.jsx)(n.li,{children:"safer permission changes"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"practical-guideline",children:"Practical Guideline"}),"\n",(0,r.jsx)(n.p,{children:"Use Zitadel roles only when the answer to both questions is yes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Does this permission apply broadly"}),"\n",(0,r.jsx)(n.li,{children:"Does it rarely change"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"If the answer is no, the permission likely belongs in OpenFGA or Cerbos."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Zitadel roles are not wrong, just limited in scope"}),"\n",(0,r.jsx)(n.li,{children:"Roles should remain coarse-grained and identity-focused"}),"\n",(0,r.jsx)(n.li,{children:"Object-level and conditional authorization require dedicated systems"}),"\n",(0,r.jsx)(n.li,{children:"Combining Zitadel, OpenFGA, and Cerbos results in a cleaner and safer architecture"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Authorization complexity does not disappear by avoiding it.",(0,r.jsx)(n.br,{}),"\n","It only moves to places where it is harder to see and control."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);