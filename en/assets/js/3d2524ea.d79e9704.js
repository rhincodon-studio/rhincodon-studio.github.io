"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2461],{5699:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>h,contentTitle:()=>u,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"prometheus/prometheus-intro","title":"Prometheus \u5c08\u5bb6\u5c0e\u89bd","description":"\u4ecb\u7d39 Kubernetes \u8207\u975e Kubernetes \u74b0\u5883\u4e0b\u7684 Prometheus \u90e8\u7f72\u8207\u4f7f\u7528\u6a21\u5f0f\u3002","source":"@site/docs/prometheus/intro.md","sourceDirName":"prometheus","slug":"/prometheus/intro","permalink":"/en/docs/prometheus/intro","draft":false,"unlisted":false,"editUrl":"https://github.com/rhincodon-studio/my-website/tree/main/docs/prometheus/intro.md","tags":[{"inline":true,"label":"prometheus","permalink":"/en/docs/tags/prometheus"},{"inline":true,"label":"monitoring","permalink":"/en/docs/tags/monitoring"},{"inline":true,"label":"kubernetes","permalink":"/en/docs/tags/kubernetes"}],"version":"current","sidebarPosition":1,"frontMatter":{"id":"prometheus-intro","title":"Prometheus \u5c08\u5bb6\u5c0e\u89bd","sidebar_label":"Prometheus Overview","description":"\u4ecb\u7d39 Kubernetes \u8207\u975e Kubernetes \u74b0\u5883\u4e0b\u7684 Prometheus \u90e8\u7f72\u8207\u4f7f\u7528\u6a21\u5f0f\u3002","slug":"/prometheus/intro","tags":["prometheus","monitoring","kubernetes"],"sidebar_position":1,"author":"rhincodon-studio"},"sidebar":"tutorialSidebar","previous":{"title":"Prometheus","permalink":"/en/docs/category/prometheus"},"next":{"title":"PVE","permalink":"/en/docs/category/pve"}}');var s=n(74848),o=n(28453);const i={id:"prometheus-intro",title:"Prometheus \u5c08\u5bb6\u5c0e\u89bd",sidebar_label:"Prometheus Overview",description:"\u4ecb\u7d39 Kubernetes \u8207\u975e Kubernetes \u74b0\u5883\u4e0b\u7684 Prometheus \u90e8\u7f72\u8207\u4f7f\u7528\u6a21\u5f0f\u3002",slug:"/prometheus/intro",tags:["prometheus","monitoring","kubernetes"],sidebar_position:1,author:"rhincodon-studio"},u="Prometheus \u5c08\u5bb6\u5c0e\u89bd",h={},l=[{value:"Kubernetes \u7248\u672c",id:"kubernetes-\u7248\u672c",level:2},{value:"\u975e Kubernetes \u7248\u672c",id:"\u975e-kubernetes-\u7248\u672c",level:2},{value:"\u7d9c\u5408\u89c0\u5bdf",id:"\u7d9c\u5408\u89c0\u5bdf",level:2},{value:"\u67b6\u69cb\u6982\u89bd",id:"\u67b6\u69cb\u6982\u89bd",level:2}];function a(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"prometheus-\u5c08\u5bb6\u5c0e\u89bd",children:"Prometheus \u5c08\u5bb6\u5c0e\u89bd"})}),"\n",(0,s.jsxs)(r.p,{children:["\u4f5c\u70ba Prometheus \u5c08\u5bb6\uff0c\u6211\u5011\u5c07\u9019\u5957\u6307\u6a19\u8207\u8b66\u5831\u5e73\u53f0\u62c6\u89e3\u70ba\u5169\u7a2e\u5e38\u898b\u7684\u90e8\u7f72\u59ff\u614b\uff1a\u4ee5 Kubernetes \u70ba\u63a7\u5236\u6838\u5fc3\u7684\u96f2\u539f\u751f\u7248\u672c\uff0c\u8207\u5728\u5176\u4ed6\u74b0\u5883\uff08VM\u3001\u88f8\u6a5f\u3001\u6df7\u5408\u96f2\uff09\u904b\u884c\u7684\u975e Kubernetes \u7248\u672c\u3002\u7121\u8ad6\u662f\u54ea\u4e00\u7a2e\uff0c\u6838\u5fc3\u54f2\u5b78\u662f\u4e00\u81f4\uff1a",(0,s.jsx)(r.strong,{children:"\u53ef\u89c0\u5bdf\u6027\u3001\u53ef\u64f4\u5c55\u6027\u8207\u53ef\u884c\u52d5\u7684\u8b66\u5831"}),"\u3002"]}),"\n",(0,s.jsx)(r.h2,{id:"kubernetes-\u7248\u672c",children:"Kubernetes \u7248\u672c"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Operator \u9a45\u52d5"}),"\uff1a\u900f\u904e Prometheus Operator \u53ca Kube-Prometheus Stack\uff0c\u7c21\u5316 CRD \u7ba1\u7406\u3001service discovery\u3001\u81ea\u52d5\u751f\u6210 ServiceMonitor \u53caRule\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u81ea\u52d5\u64f4\u7e2e"}),"\uff1a\u914d\u5408 HorizontalPodAutoscaler \u6216 Keda\uff0c\u4f9d\u6307\u6a19\u983b\u7387\u8207\u8cc7\u6e90\u4f7f\u7528\u91cf\u8abf\u6574 Prometheus Pod \u6578\u91cf\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u591a\u79df\u6236\u5206\u5c64"}),"\uff1a\u53ef\u5c07\u96c6\u7fa4\u6307\u6a19\u8207\u61c9\u7528\u6307\u6a19\u5206\u958b\u76e3\u63a7\uff0c\u5229\u7528 Thanos/ Cortex \u505a\u8de8\u96c6\u7fa4\u8cc7\u6599\u805a\u5408\u8207\u9577\u671f\u5132\u5b58\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"GitOps Friendly"}),"\uff1a\u5ba3\u544a\u5f0f\u7684 ",(0,s.jsx)(r.code,{children:"PrometheusRule"}),"\u3001",(0,s.jsx)(r.code,{children:"ServiceMonitor"})," \u8207 ",(0,s.jsx)(r.code,{children:"PodMonitor"})," \u53ef\u7d0d\u5165 Git pull request \u6d41\u7a0b\uff0c\u4ee5\u7248\u672c\u63a7\u5236\u6307\u6a19\u914d\u7f6e\u3002"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"\u975e-kubernetes-\u7248\u672c",children:"\u975e Kubernetes \u7248\u672c"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u7cfb\u7d71\u578b\u90e8\u7f72"}),"\uff1a\u5229\u7528\u4e8c\u9032\u4f4d\u3001\u5bb9\u5668\u6216 systemd + Prometheus binary\uff0c\u76f4\u63a5\u5728 VM \u6216\u88f8\u6a5f\u4e0a\u90e8\u7f72 node_exporter\u3001blackbox_exporter \u7b49\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u9748\u6d3b\u767c\u73fe"}),"\uff1a\u900f\u904e ",(0,s.jsx)(r.code,{children:"file_sd_configs"})," \u642d\u914d Consul\u3001DNS \u8207\u81ea\u8a02\u8173\u672c\u81ea\u52d5\u5316\u767c\u73fe\u5be6\u9ad4\u4e3b\u6a5f\uff0c\u6216\u5229\u7528 ",(0,s.jsx)(r.code,{children:"relabel_configs"})," \u8655\u7406\u8907\u96dc\u7db2\u6bb5\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Sidecar \u7d50\u69cb"}),"\uff1a\u5982\u679c\u5df2\u6709 legacy \u6216 edge \u5e73\u53f0\uff0c\u53ef\u4ee5\u5728\u9644\u8fd1\u90e8\u7f72 Prometheus \u5be6\u4f8b\uff0c\u5c07\u8cc7\u6599\u63a8\u9001\u5230\u96c6\u4e2d\u5316\u7684\u9060\u7aef\u5beb\u5165\uff08Remote Write\uff09\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u5bb9\u91cf\u9810\u6e2c"}),"\uff1a\u85c9\u7531\u6307\u6a19\u63a1\u6a23\u7387\u8207\u4fdd\u7559\u671f\u9650\u7684\u8a2d\u5b9a\uff0c\u642d\u914d ",(0,s.jsx)(r.code,{children:"storage.tsdb.retention.time"})," \u53ca\u78c1\u789f\u76e3\u63a7\uff0c\u907f\u514d\u8cc7\u6599\u7206\u8868\u3002"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"\u7d9c\u5408\u89c0\u5bdf",children:"\u7d9c\u5408\u89c0\u5bdf"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u67b6\u69cb\u4e00\u81f4\u6027"}),"\uff1a\u4e0d\u8ad6\u5728\u54ea\u7a2e\u74b0\u5883\uff0cPrometheus \u7686\u4ee5 pull \u70ba\u4e3b\uff0c\u78ba\u4fdd\u6bcf\u4e00\u6b21 scraping \u90fd\u53ef\u8ffd\u6eaf\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u8b66\u5831\u7b56\u7565"}),"\uff1a\u5c07 ",(0,s.jsx)(r.code,{children:"alertmanager"})," \u8207\u901a\u77e5\u983b\u9053\u5206\u5c64\u7ba1\u7406\uff0c\u907f\u514d high-cardinality \u6307\u6a19\u5c0e\u81f4\u983b\u7e41\u566a\u97f3\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u9577\u671f\u8cc7\u6599"}),"\uff1a\u82e5\u9700\u8981\u5b58\u653e\u6b77\u53f2\u8cc7\u6599\u8acb\u642d\u914d Thanos/Cortex\uff0c\u6216\u4f7f\u7528 remote storage hooks \u5c07\u5feb\u53d6\u8cc7\u6599\u540c\u6b65\u81f3 object storage\u3002"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"\u67b6\u69cb\u6982\u89bd",children:"\u67b6\u69cb\u6982\u89bd"}),"\n",(0,s.jsx)(r.mermaid,{value:"graph TD\n    subgraph Kubernetes Cluster\n        operator(Prometheus Operator)\n        prometheus(Prometheus instance)\n        ksm(Kube-State-Metrics)\n        kube(Pod/Service Exporters)\n        alertmanager(Alertmanager)\n        thanos(Thanos Sidecar)\n    end\n    subgraph Non-Kubernetes Environment\n        node(node_exporter)\n        push(Pushgateway)\n        exporters(Custom Exporters)\n    end\n    subgraph Remote Storage\n        cortex(Cortex/Thanos Store)\n        obj(Object Storage)\n        grafana(Grafana)\n    end\n    operator --\x3e prometheus\n    prometheus --\x3e |scrape| ksm\n    prometheus --\x3e kube\n    prometheus --\x3e node\n    prometheus --\x3e exporters\n    prometheus --\x3e alertmanager\n    prometheus --\x3e thanos\n    thanos --\x3e cortex\n    cortex --\x3e obj\n    prometheus --\x3e |remote_write| cortex\n    push --\x3e prometheus\n    exporters --\x3e prometheus\n    alertmanager --\x3e |notifications| Ops(Operations team)\n    grafana --\x3e prometheus\n    grafana --\x3e cortex"}),"\n",(0,s.jsx)(r.p,{children:"\u9019\u5f35\u67b6\u69cb\u5716\u5c55\u793a\u4e86 Kubernetes \u4e2d\u7531 Operator \u9577\u51fa Prometheus \u5be6\u4f8b\u3001\u900f\u904e ServiceMonitor / PodMonitor \u6383\u63cf\u6307\u6a19\u4f86\u6e90\u3001\u518d\u8207 Thanos/Cortex \u505a\u9060\u7aef\u5beb\u5165\uff1b\u975e Kubernetes \u7bc0\u9ede\u5247\u4ee5 exporters/Pushgateway \u76f4\u63a5\u5c0d Prometheus \u63d0\u4f9b\u6307\u6a19\uff0c\u800c Alertmanager \u5c07\u901a\u77e5\u9001\u7d66\u71df\u904b\u5718\u968a\u3002"}),"\n",(0,s.jsxs)(r.p,{children:["\u6b61\u8fce\u9032\u4e00\u6b65\u63a2\u7d22 ",(0,s.jsx)(r.code,{children:"/prometheus/kubernetes"})," \u8207 ",(0,s.jsx)(r.code,{children:"/prometheus/non-kubernetes"})," \u7b49\u7ae0\u7bc0\uff0c\u8b93\u5718\u968a\u5728\u4efb\u4e00\u57fa\u790e\u4e0a\u90fd\u80fd\u5efa\u7acb\u7b26\u5408 Rhincodon Studio \u6a19\u6e96\u7684\u53ef\u89c0\u5bdf\u6027\u5e73\u53f0\u3002"]})]})}function d(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>u});var t=n(96540);const s={},o=t.createContext(s);function i(e){const r=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function u(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);