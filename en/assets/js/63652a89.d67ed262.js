"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4343],{28453:(n,e,l)=>{l.d(e,{R:()=>a,x:()=>p});var s=l(96540);const r={},i=s.createContext(r);function a(n){const e=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function p(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:a(n.components),s.createElement(i.Provider,{value:e},n.children)}},76979:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>x,contentTitle:()=>p,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var s=l(87352),r=l(74848),i=l(28453);const a={id:"deploy-nx-multiple-apps-to-nginx",title:"\u5c07\u591a\u500b Nx Apps \u90e8\u7f72\u5230\u540c\u4e00\u500b Nginx \u4e0b",sidebar_label:"Nx \u591a App \u90e8\u7f72\u5230 Nginx",description:"\u6559\u4f60\u5982\u4f55\u5c07 Nx monorepo \u5167\u591a\u500b Angular / Web apps \u900f\u904e Nginx \u90e8\u7f72\u5230\u540c\u4e00\u500b\u57df\u540d\u6216\u4e0d\u540c\u8def\u5f91\u4e0b\u3002",tags:["nx","angular","nginx","deployment"]},p="\u5c07\u591a\u500b Nx Apps \u90e8\u7f72\u5230\u540c\u4e00\u500b Nginx \u4e0b",x={authorsImageUrls:[]},d=[{value:"\u65b9\u6cd5 A\uff1a\u4f7f\u7528\u4e0d\u540c\u8def\u5f91\uff08\u6700\u5e38\u898b\uff09",id:"\u65b9\u6cd5-a\u4f7f\u7528\u4e0d\u540c\u8def\u5f91\u6700\u5e38\u898b",level:2},{value:"Nginx \u8a2d\u5b9a",id:"nginx-\u8a2d\u5b9a",level:3},{value:"Angular / Nx Build \u6307\u4ee4",id:"angular--nx-build-\u6307\u4ee4",level:3},{value:"\u90e8\u7f72\u7684\u8cc7\u6599\u593e\u7d50\u69cb",id:"\u90e8\u7f72\u7684\u8cc7\u6599\u593e\u7d50\u69cb",level:3},{value:"\u65b9\u6cd5 B\uff1a\u4f7f\u7528\u4e0d\u540c\u5b50\u7db2\u57df",id:"\u65b9\u6cd5-b\u4f7f\u7528\u4e0d\u540c\u5b50\u7db2\u57df",level:2},{value:"Nginx \u8a2d\u5b9a",id:"nginx-\u8a2d\u5b9a-1",level:3},{value:"Angular / Nx Build \u6307\u4ee4",id:"angular--nx-build-\u6307\u4ee4-1",level:3},{value:"\u65b9\u6cd5 C\uff1a\u900f\u904e Proxy Pass \u5c0e\u6d41\u5230\u5f8c\u7aef\u670d\u52d9\uff08API / SSR / Node / NodeJS\uff09",id:"\u65b9\u6cd5-c\u900f\u904e-proxy-pass-\u5c0e\u6d41\u5230\u5f8c\u7aef\u670d\u52d9api--ssr--node--nodejs",level:2},{value:"Nginx Proxy Pass \u8a2d\u5b9a\u7bc4\u4f8b",id:"nginx-proxy-pass-\u8a2d\u5b9a\u7bc4\u4f8b",level:3},{value:"\u5e38\u898b Proxy Pass \u5834\u666f",id:"\u5e38\u898b-proxy-pass-\u5834\u666f",level:3},{value:"Nx + NodeJS \u670d\u52d9\u5e38\u7528\u6307\u4ee4",id:"nx--nodejs-\u670d\u52d9\u5e38\u7528\u6307\u4ee4",level:3},{value:"\u5e38\u898b\u554f\u984c\uff08FAQ\uff09",id:"\u5e38\u898b\u554f\u984cfaq",level:2},{value:"\u70ba\u4ec0\u9ebc\u91cd\u65b0\u6574\u7406\u6703\u51fa\u73fe 404\uff1f",id:"\u70ba\u4ec0\u9ebc\u91cd\u65b0\u6574\u7406\u6703\u51fa\u73fe-404",level:3},{value:"Proxy Pass \u7121\u6cd5\u9023\u7dda\uff1f",id:"proxy-pass-\u7121\u6cd5\u9023\u7dda",level:3},{value:"\u7e3d\u7d50",id:"\u7e3d\u7d50",level:2}];function o(n){const e={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:"Nx monorepo \u5167\u901a\u5e38\u5305\u542b\u591a\u500b\u524d\u7aef\u6216\u5f8c\u7aef\u61c9\u7528\uff0c\u4f8b\u5982\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"apps/\n  app1/\n  app2/\n  app3/\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u900f\u904e Nx build \u5f8c\uff0c\u4f60\u6703\u5f97\u5230\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"dist/apps/app1/\ndist/apps/app2/\ndist/apps/app3/\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u7bc7\u6587\u7ae0\u5c07\u6559\u4f60\u5982\u4f55\u628a\u9019\u4e9b apps \u540c\u6642\u90e8\u7f72\u5230\u540c\u4e00\u500b Nginx \u4e0b\uff0c\u4e26\u4f7f\u7528\u4e0d\u540c\u8def\u5f91\u6216\u4e0d\u540c\u5b50\u7db2\u57df\u3002"}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u65b9\u6cd5-a\u4f7f\u7528\u4e0d\u540c\u8def\u5f91\u6700\u5e38\u898b",children:"\u65b9\u6cd5 A\uff1a\u4f7f\u7528\u4e0d\u540c\u8def\u5f91\uff08\u6700\u5e38\u898b\uff09"}),"\n",(0,r.jsx)(e.p,{children:"\u4f8b\u5982\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://example.com/app1",children:"https://example.com/app1"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://example.com/app2",children:"https://example.com/app2"})}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"nginx-\u8a2d\u5b9a",children:"Nginx \u8a2d\u5b9a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"server {\n  listen 80;\n  server_name example.com;\n\n  location /app1/ {\n    alias /usr/share/nginx/html/app1/;\n    try_files $uri $uri/ /app1/index.html;\n  }\n\n  location /app2/ {\n    alias /usr/share/nginx/html/app2/;\n    try_files $uri $uri/ /app2/index.html;\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"angular--nx-build-\u6307\u4ee4",children:"Angular / Nx Build \u6307\u4ee4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"nx build app1 --configuration production --base-href=/app1/\nnx build app2 --configuration production --base-href=/app2/\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u90e8\u7f72\u7684\u8cc7\u6599\u593e\u7d50\u69cb",children:"\u90e8\u7f72\u7684\u8cc7\u6599\u593e\u7d50\u69cb"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"/usr/share/nginx/html/\n  app1/\n  app2/\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u65b9\u6cd5-b\u4f7f\u7528\u4e0d\u540c\u5b50\u7db2\u57df",children:"\u65b9\u6cd5 B\uff1a\u4f7f\u7528\u4e0d\u540c\u5b50\u7db2\u57df"}),"\n",(0,r.jsx)(e.p,{children:"\u4f8b\u5982\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://app1.example.com",children:"https://app1.example.com"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://app2.example.com",children:"https://app2.example.com"})}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"nginx-\u8a2d\u5b9a-1",children:"Nginx \u8a2d\u5b9a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"server {\n  server_name app1.example.com;\n  root /usr/share/nginx/html/app1;\n  try_files $uri $uri/ /index.html;\n}\n\nserver {\n  server_name app2.example.com;\n  root /usr/share/nginx/html/app2;\n  try_files $uri $uri/ /index.html;\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"angular--nx-build-\u6307\u4ee4-1",children:"Angular / Nx Build \u6307\u4ee4"}),"\n",(0,r.jsxs)(e.p,{children:["\u7531\u65bc\u6bcf\u500b app \u76f4\u63a5\u639b\u5728\u6839\u76ee\u9304\uff08/\uff09\uff0c",(0,r.jsx)(e.code,{children:"baseHref"})," \u8a2d\u70ba ",(0,r.jsx)(e.code,{children:"/"})," \u5373\u53ef\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"nx build app1 --configuration production --base-href=/\nnx build app2 --configuration production --base-href=/\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u65b9\u6cd5-c\u900f\u904e-proxy-pass-\u5c0e\u6d41\u5230\u5f8c\u7aef\u670d\u52d9api--ssr--node--nodejs",children:"\u65b9\u6cd5 C\uff1a\u900f\u904e Proxy Pass \u5c0e\u6d41\u5230\u5f8c\u7aef\u670d\u52d9\uff08API / SSR / Node / NodeJS\uff09"}),"\n",(0,r.jsxs)(e.p,{children:["\u5982\u679c\u4f60\u7684 Nx monorepo \u4e2d\u5305\u542b\u5f8c\u7aef\u670d\u52d9\uff08\u4f8b\u5982 NodeJS API\uff09\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"proxy_pass"}),"\uff1a\n\u8b93 Nginx \u5c07 ",(0,r.jsx)(e.code,{children:"/api"})," \u76f8\u95dc\u8acb\u6c42\u5c0e\u5411\u5f8c\u7aef server\u3002"]}),"\n",(0,r.jsx)(e.h3,{id:"nginx-proxy-pass-\u8a2d\u5b9a\u7bc4\u4f8b",children:"Nginx Proxy Pass \u8a2d\u5b9a\u7bc4\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"server {\n  listen 80;\n  server_name example.com;\n\n  # \u524d\u7aef Angular App\n  location / {\n    root /usr/share/nginx/html/app1;\n    try_files $uri $uri/ /index.html;\n  }\n\n  # API Proxy\n  location /api/ {\n    proxy_pass http://localhost:3333/; # Nx serve / NodeJS \u7684 API port\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection 'upgrade';\n    proxy_set_header Host $host;\n    proxy_cache_bypass $http_upgrade;\n  }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u5e38\u898b-proxy-pass-\u5834\u666f",children:"\u5e38\u898b Proxy Pass \u5834\u666f"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Nx + Angular \u524d\u7aef + NodeJS API"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"/"})," \u2192 \u524d\u7aef"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"/api"})," \u2192 \u5f8c\u7aef\uff08NodeJS\uff09"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u591a\u5f8c\u7aef\u670d\u52d9\uff08\u5fae\u670d\u52d9\u7d50\u69cb\uff09"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"/auth"})," \u2192 Auth service"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"/order"})," \u2192 Order service"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"/payment"})," \u2192 Payment service"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"nx--nodejs-\u670d\u52d9\u5e38\u7528\u6307\u4ee4",children:"Nx + NodeJS \u670d\u52d9\u5e38\u7528\u6307\u4ee4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"nx serve api\nnx build api\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u5e38\u898b\u554f\u984cfaq",children:"\u5e38\u898b\u554f\u984c\uff08FAQ\uff09"}),"\n",(0,r.jsx)(e.h3,{id:"\u70ba\u4ec0\u9ebc\u91cd\u65b0\u6574\u7406\u6703\u51fa\u73fe-404",children:"\u70ba\u4ec0\u9ebc\u91cd\u65b0\u6574\u7406\u6703\u51fa\u73fe 404\uff1f"}),"\n",(0,r.jsx)(e.p,{children:"SPA\uff08\u5982 Angular\uff09\u672c\u8eab\u6c92\u6709\u771f\u6b63\u7684\u8def\u5f91\uff0c\u56e0\u6b64 Nginx \u9700\u8981\u8a2d\u5b9a\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-nginx",children:"try_files $uri $uri/ /index.html;\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u9019\u6703\u8b93\u6240\u6709\u8def\u5f91\u56de\u5230 Angular \u7684 router \u8655\u7406\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"proxy-pass-\u7121\u6cd5\u9023\u7dda",children:"Proxy Pass \u7121\u6cd5\u9023\u7dda\uff1f"}),"\n",(0,r.jsx)(e.p,{children:"\u6aa2\u67e5\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u5f8c\u7aef port \u662f\u5426\u6b63\u78ba\uff08\u5982 ",(0,r.jsx)(e.code,{children:"3333"}),"\uff09"]}),"\n",(0,r.jsx)(e.li,{children:"\u5f8c\u7aef\u662f\u5426\u5141\u8a31\u4f86\u81ea localhost \u7684 request"}),"\n",(0,r.jsxs)(e.li,{children:["Nginx \u6709\u6c92\u6709\u52a0 ",(0,r.jsx)(e.code,{children:"proxy_set_header Host $host"})]}),"\n",(0,r.jsxs)(e.li,{children:["\u662f\u5426\u9700\u8981 HTTPS \u2192 HTTP \u7684 ",(0,r.jsx)(e.code,{children:"proxy_redirect off;"})]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u7e3d\u7d50",children:"\u7e3d\u7d50"}),"\n",(0,r.jsx)(e.p,{children:"\u4f60\u53ef\u4ee5\u900f\u904e\u4e09\u7a2e\u65b9\u5f0f\u628a\u591a\u500b Nx apps \u8207\u5f8c\u7aef\u90e8\u7f72\u5728\u540c\u4e00\u500b Nginx\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4e0d\u540c\u8def\u5f91"}),"\uff08\u6700\u5e38\u898b\u3001\u55ae\u4e00 domain\uff09"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4e0d\u540c\u5b50\u7db2\u57df"}),"\uff08\u4e7e\u6de8\u3001\u597d\u7ba1\u7406\uff09"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Proxy Pass \u5c0e\u5f8c\u7aef API"}),"\uff08\u524d\u5f8c\u7aef\u6574\u5408\u6700\u4f73\u89e3\uff09"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u53ea\u8981\u6b63\u78ba\u8a2d\u5b9a\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Nginx alias/root"}),"\n",(0,r.jsx)(e.li,{children:"Angular baseHref"}),"\n",(0,r.jsx)(e.li,{children:"try_files"}),"\n",(0,r.jsx)(e.li,{children:"proxy_pass\uff08\u5982\u6709\u5f8c\u7aef API\uff09"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u5373\u53ef\u9054\u6210\u5b8c\u6574\u7684 Nx monorepo \u90e8\u7f72\u67b6\u69cb\u3002"})]})}function c(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},87352:n=>{n.exports=JSON.parse('{"permalink":"/en/blog/2025/11/28/","source":"@site/blog/2025-11-28.md","title":"\u5c07\u591a\u500b Nx Apps \u90e8\u7f72\u5230\u540c\u4e00\u500b Nginx \u4e0b","description":"\u6559\u4f60\u5982\u4f55\u5c07 Nx monorepo \u5167\u591a\u500b Angular / Web apps \u900f\u904e Nginx \u90e8\u7f72\u5230\u540c\u4e00\u500b\u57df\u540d\u6216\u4e0d\u540c\u8def\u5f91\u4e0b\u3002","date":"2025-11-28T00:00:00.000Z","tags":[{"inline":true,"label":"nx","permalink":"/en/blog/tags/nx"},{"inline":true,"label":"angular","permalink":"/en/blog/tags/angular"},{"inline":true,"label":"nginx","permalink":"/en/blog/tags/nginx"},{"inline":true,"label":"deployment","permalink":"/en/blog/tags/deployment"}],"readingTime":2.36,"hasTruncateMarker":false,"authors":[],"frontMatter":{"id":"deploy-nx-multiple-apps-to-nginx","title":"\u5c07\u591a\u500b Nx Apps \u90e8\u7f72\u5230\u540c\u4e00\u500b Nginx \u4e0b","sidebar_label":"Nx \u591a App \u90e8\u7f72\u5230 Nginx","description":"\u6559\u4f60\u5982\u4f55\u5c07 Nx monorepo \u5167\u591a\u500b Angular / Web apps \u900f\u904e Nginx \u90e8\u7f72\u5230\u540c\u4e00\u500b\u57df\u540d\u6216\u4e0d\u540c\u8def\u5f91\u4e0b\u3002","tags":["nx","angular","nginx","deployment"]},"unlisted":false,"prevItem":{"title":"\u5728 WebStorm \u4e2d\u6574\u5408 Codex \u5de5\u4f5c\u6d41\u7a0b","permalink":"/en/blog/webstorm-codex-setup"},"nextItem":{"title":"Nx App \u62c6\u5206\u512a\u52e2\u8207\u7b56\u7565\u6b65\u9a5f","permalink":"/en/blog/nx-app-split-strategy"}}')}}]);