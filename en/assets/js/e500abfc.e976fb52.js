"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6921],{28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>t});var s=r(96540);const o={},i=s.createContext(o);function l(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(i.Provider,{value:n},e.children)}},70617:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"kubernetes-rke2/rke2-troubleshooting-nfs-provisioner","title":"Troubleshooting\uff1aNFS Provisioner","description":"Troubleshooting guide for NFS mount errors when using nfs-subdir-external-provisioner on RKE2.","source":"@site/docs/kubernetes-rke2/rke2-ts-nfs-provisioner.md","sourceDirName":"kubernetes-rke2","slug":"/kubernetes-rke2/rke2-troubleshooting-nfs-provisioner","permalink":"/en/docs/kubernetes-rke2/rke2-troubleshooting-nfs-provisioner","draft":false,"unlisted":false,"editUrl":"https://github.com/rhincodon-studio/my-website/tree/main/docs/kubernetes-rke2/rke2-ts-nfs-provisioner.md","tags":[],"version":"current","sidebarPosition":910,"frontMatter":{"id":"rke2-troubleshooting-nfs-provisioner","title":"Troubleshooting\uff1aNFS Provisioner","sidebar_label":"Troubleshooting\uff1aNFS Provisioner","description":"Troubleshooting guide for NFS mount errors when using nfs-subdir-external-provisioner on RKE2.","sidebar_position":910,"author":"balnibarbian"},"sidebar":"tutorialSidebar","previous":{"title":"Troubleshooting\uff1aetcd \u8207\u8a18\u61b6\u9ad4\u4e0d\u8db3","permalink":"/en/docs/kubernetes-rke2/rke2-troubleshooting-etcd"},"next":{"title":"Prometheus","permalink":"/en/docs/category/prometheus"}}');var o=r(74848),i=r(28453);const l={id:"rke2-troubleshooting-nfs-provisioner",title:"Troubleshooting\uff1aNFS Provisioner",sidebar_label:"Troubleshooting\uff1aNFS Provisioner",description:"Troubleshooting guide for NFS mount errors when using nfs-subdir-external-provisioner on RKE2.",sidebar_position:910,author:"balnibarbian"},t="RKE2 Troubleshooting: NFS Provisioner",d={},c=[{value:"Error Description",id:"error-description",level:2},{value:"1. Ensure NFS client tools are installed on worker nodes",id:"1-ensure-nfs-client-tools-are-installed-on-worker-nodes",level:2},{value:"Ubuntu / Debian",id:"ubuntu--debian",level:3},{value:"CentOS / RHEL / Rocky / Alma",id:"centos--rhel--rocky--alma",level:3},{value:"openSUSE / SLES",id:"opensuse--sles",level:3},{value:"2. Test manual mount on the worker node",id:"2-test-manual-mount-on-the-worker-node",level:2},{value:"3. Verify Synology (or NFS server) configuration",id:"3-verify-synology-or-nfs-server-configuration",level:2},{value:"4. Set required mount options (if needed)",id:"4-set-required-mount-options-if-needed",level:2},{value:"For NFSv3:",id:"for-nfsv3",level:3},{value:"For NFSv4.1:",id:"for-nfsv41",level:3},{value:"5. Validate NFS server path and Helm chart values",id:"5-validate-nfs-server-path-and-helm-chart-values",level:2},{value:"6. Check firewall ports",id:"6-check-firewall-ports",level:2},{value:"7. Check SELinux or AppArmor restrictions",id:"7-check-selinux-or-apparmor-restrictions",level:2},{value:"SELinux",id:"selinux",level:3},{value:"AppArmor",id:"apparmor",level:3},{value:"Summary of Common Causes",id:"summary-of-common-causes",level:2}];function u(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"rke2-troubleshooting-nfs-provisioner",children:"RKE2 Troubleshooting: NFS Provisioner"})}),"\n",(0,o.jsx)(n.h2,{id:"error-description",children:"Error Description"}),"\n",(0,o.jsx)(n.p,{children:"The following error occurs when Kubernetes attempts to mount an NFS volume:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'MountVolume.SetUp failed for volume "nfs-subdir-external-provisioner-root" : mount failed: exit status 32\nMounting command: mount\nMounting arguments: -t nfs 192.168.100.100:/volume1/rke2-pv /var/lib/kubelet/pods/b6ad96fb...\nOutput: mount: ... bad option; for several filesystems you might need a mount.<type> helper program.\n'})}),"\n",(0,o.jsx)(n.p,{children:"This indicates that the node cannot mount the NFS directory."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"1-ensure-nfs-client-tools-are-installed-on-worker-nodes",children:"1. Ensure NFS client tools are installed on worker nodes"}),"\n",(0,o.jsx)(n.p,{children:"Different Linux distributions require different packages."}),"\n",(0,o.jsx)(n.h3,{id:"ubuntu--debian",children:"Ubuntu / Debian"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"sudo apt-get update\nsudo apt-get install -y nfs-common\n"})}),"\n",(0,o.jsx)(n.h3,{id:"centos--rhel--rocky--alma",children:"CentOS / RHEL / Rocky / Alma"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"sudo yum install -y nfs-utils\n"})}),"\n",(0,o.jsx)(n.h3,{id:"opensuse--sles",children:"openSUSE / SLES"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"sudo zypper install -y nfs-client\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The node must contain ",(0,o.jsx)(n.code,{children:"mount.nfs"}),". Missing tools will cause exit status 32."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"2-test-manual-mount-on-the-worker-node",children:"2. Test manual mount on the worker node"}),"\n",(0,o.jsx)(n.p,{children:"Run:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"sudo mount -t nfs 192.168.100.100:/volume1/rke2-pv /mnt\n"})}),"\n",(0,o.jsx)(n.p,{children:"If this fails, inspect kernel messages:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"dmesg | tail\n"})}),"\n",(0,o.jsx)(n.p,{children:"Common issues:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Permission denied"}),"\n",(0,o.jsx)(n.li,{children:"RPC service not running"}),"\n",(0,o.jsx)(n.li,{children:"Access denied by server"}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"3-verify-synology-or-nfs-server-configuration",children:"3. Verify Synology (or NFS server) configuration"}),"\n",(0,o.jsx)(n.p,{children:"For Synology NAS:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Enable NFS service"}),"\n",(0,o.jsx)(n.li,{children:"Edit Shared Folder \u2192 NFS Permissions"}),"\n",(0,o.jsxs)(n.li,{children:["Add Kubernetes node subnet (e.g. ",(0,o.jsx)(n.code,{children:"192.168.2.0/24"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:["Squash: ",(0,o.jsx)(n.em,{children:"Map all users to admin"})," (recommended for PV creation)"]}),"\n",(0,o.jsx)(n.li,{children:"Enable NFSv3 (some kubelet versions require it)"}),"\n",(0,o.jsx)(n.li,{children:"Apply settings"}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"4-set-required-mount-options-if-needed",children:"4. Set required mount options (if needed)"}),"\n",(0,o.jsx)(n.p,{children:"Some NFS servers require specifying the version explicitly."}),"\n",(0,o.jsx)(n.h3,{id:"for-nfsv3",children:"For NFSv3:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"nfs:\n  mountOptions:\n    - nfsvers=3\n"})}),"\n",(0,o.jsx)(n.h3,{id:"for-nfsv41",children:"For NFSv4.1:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"nfs:\n  mountOptions:\n    - nfsvers=4.1\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"5-validate-nfs-server-path-and-helm-chart-values",children:"5. Validate NFS server path and Helm chart values"}),"\n",(0,o.jsx)(n.p,{children:"Ensure your values.yaml matches:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"nfs:\n  server: 192.168.100.100\n  path: /volume1/rke2-pv\n"})}),"\n",(0,o.jsx)(n.p,{children:"Errors in the path produce mount failures."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"6-check-firewall-ports",children:"6. Check firewall ports"}),"\n",(0,o.jsx)(n.p,{children:"NFS requires the following:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"111 (rpcbind)"}),"\n",(0,o.jsx)(n.li,{children:"2049 (nfs)"}),"\n",(0,o.jsx)(n.li,{children:"20048 (mountd)"}),"\n",(0,o.jsx)(n.li,{children:"Additional dynamic ports depending on configuration"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Open these ports for Kubernetes nodes."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"7-check-selinux-or-apparmor-restrictions",children:"7. Check SELinux or AppArmor restrictions"}),"\n",(0,o.jsx)(n.h3,{id:"selinux",children:"SELinux"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"getenforce\n"})}),"\n",(0,o.jsxs)(n.p,{children:["If it's ",(0,o.jsx)(n.code,{children:"Enforcing"}),", run:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"sudo setsebool -P virt_use_nfs 1\n"})}),"\n",(0,o.jsx)(n.h3,{id:"apparmor",children:"AppArmor"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"sudo aa-status | grep nfs\n"})}),"\n",(0,o.jsx)(n.p,{children:"Profiles may block NFS mounting."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"summary-of-common-causes",children:"Summary of Common Causes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Missing NFS client tools (",(0,o.jsx)(n.code,{children:"nfs-common"}),", ",(0,o.jsx)(n.code,{children:"nfs-utils"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"Incorrect NFS permissions on Synology or server"}),"\n",(0,o.jsx)(n.li,{children:"Wrong export path"}),"\n",(0,o.jsx)(n.li,{children:"Required NFS version mismatch"}),"\n",(0,o.jsx)(n.li,{children:"Firewall blocking RPC/NFS ports"}),"\n",(0,o.jsx)(n.li,{children:"SELinux/AppArmor policies blocking mounts"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}}}]);